<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Journal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #EFECE7;
      color: #000;
      display: flex;
      justify-content: center;
    }

    .app {
      max-width: 430px;
      width: 100%;
      min-height: 100vh;
      position: relative;
    }

    .page { display: none; min-height: 100vh; padding: 16px; box-sizing: border-box; }
    .page.active { display: block; }

    .cover-wrapper { position: relative; margin-top: 24px; }
    .cover-wrapper img { width: 100%; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.12); }
    .skip-btn, .next-btn {
      position: absolute; background: none; border: none; cursor: pointer;
    }
    .skip-btn { bottom: 16px; left: 50%; transform: translateX(-50%); font-size: 14px; text-decoration: underline; }
    .next-btn { bottom: 16px; right: 16px; font-size: 28px; }

    .card {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.12);
      font-size: 14px;
      line-height: 1.6;
      margin-top: 24px;
      position: relative;
    }

  </style>
</head>

<body>
<div class="app">

  <!-- COVER PAGE -->
  <div id="coverPage" class="page active">
    <div class="cover-wrapper">
      <img src="https://hkdgqdmxhtnxtcuqfovq.supabase.co/storage/v1/object/public/Other/MyJournal.png" alt="Journal cover" />
      <button class="skip-btn" onclick="showPage('journalPage')">Skip welcome</button>
      <button class="next-btn" onclick="showPage('welcomePage')">→</button>
    </div>
  </div>

  <!-- WELCOME PAGE -->
  <div id="welcomePage" class="page">
    <div class="card">
      <h1 style="font-size:22px; margin-bottom:16px;">Welcome to Your Journal!</h1>
      <p style="margin-bottom:20px;">This journal is yours, for you to journal however you like.</p>

      <p><strong>Suggestions for journaling:</strong></p>
      <p><em>Try to make it a habit to journal after a practice.</em></p>
      <p><em>Use the journal prompts from the journal section for inspiration.</em></p>
      <p><em>Find a time of day, morning or evening, to journal consistently.</em></p>

      <p style="margin-top:16px;"><strong>Practical information:</strong></p>
      <p>You can journal as often as you like.</p>
      <p>All journal entries are date and time-stamped.</p>
      <p>The journal works offline as well.</p>

      <p style="margin-top:16px;"><strong>Tracking:</strong></p>
      <p>On the daily journal page, you can skip back and forth between entries.</p>
      <p>Open calendar view to see how often you journal.</p>
      <p>Tap blue entries in the calendar to access that day.</p>

      <p style="margin-top:16px;"><strong>Saved:</strong></p>
      <p>Everything you write is auto-saved.</p>
      <p>Entries are saved for 365 days.</p>
      <p>You can download all entries as a txt file.</p>

      <p style="margin-top:16px;"><strong>Security:</strong></p>
      <p>All data is stored locally and is private.</p>

      <p style="margin-top:16px;"><em>Please note:</em></p>
      <p><em>If the app is deleted, your data is lost unless downloaded.</em></p>
      <p><em>Anyone with physical access to your device could read entries.</em></p>

      <button class="next-btn" onclick="showPage('journalPage')">→</button>
    </div>
  </div>

  <!-- JOURNAL PAGE (UNCHANGED) -->
  <div id="journalPage" class="page">
    <!-- ORIGINAL REACT JOURNAL APP -->
    <div id="journalRoot"></div>
  </div>

</div>

<script type="text/javascript">
  // Page switching like Sudoku
  function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  // Swipe support
  let startX = 0;
  document.addEventListener('touchstart', e => startX = e.touches[0].clientX);
  document.addEventListener('touchend', e => {
    const diff = e.changedTouches[0].clientX - startX;
    const current = document.querySelector('.page.active').id;
    if (diff < -50) {
      if (current === 'coverPage') showPage('welcomePage');
      else if (current === 'welcomePage') showPage('journalPage');
    }
  });
</script>

<!-- LOAD ORIGINAL REACT JOURNAL APP -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
// Paste your entire JournalApp code here
  /* =========================
   JOURNAL APP (READY)
========================= */

const STORAGE_KEY = "journal_entries";

function JournalApp() {
  const today = new Date();
  const todayKey = today.toISOString().split("T")[0];

  const [entries, setEntries] = React.useState({});
  const [currentDate, setCurrentDate] = React.useState(todayKey);
  const [entryIndex, setEntryIndex] = React.useState(null); // CLEAN START
  const [text, setText] = React.useState("");
  const [lined, setLined] = React.useState(false);
  const [showCalendar, setShowCalendar] = React.useState(false);
  const [calendarMonth, setCalendarMonth] = React.useState(new Date());

  // Load storage ONLY (no auto-load entry)
  React.useEffect(() => {
    const stored = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
    setEntries(stored);
    setText("");
    setEntryIndex(null);
  }, []);

  // Auto-save
  React.useEffect(() => {
    if (!text) return;

    setEntries(prev => {
      const dayEntries = prev[currentDate] || [];
      const updated = [...dayEntries];

      if (entryIndex === null) {
        updated.push({
          text,
          timestamp: new Date().toString()
        });
        setEntryIndex(updated.length - 1);
      } else {
        updated[entryIndex].text = text;
      }

      const next = { ...prev, [currentDate]: updated };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(next));
      return next;
    });
  }, [text]);

  const currentTimestamp =
    entryIndex !== null
      ? entries[currentDate]?.[entryIndex]?.timestamp
      : null;

  const goEarlierEntry = () => {
    if (entryIndex > 0) {
      setEntryIndex(i => i - 1);
      setText(entries[currentDate][entryIndex - 1].text);
    }
  };

  const goLaterEntry = () => {
    if (entryIndex < (entries[currentDate]?.length || 0) - 1) {
      setEntryIndex(i => i + 1);
      setText(entries[currentDate][entryIndex + 1].text);
    }
  };

  // Calendar helpers
  const startOfMonth = new Date(calendarMonth.getFullYear(), calendarMonth.getMonth(), 1);
  const endOfMonth = new Date(calendarMonth.getFullYear(), calendarMonth.getMonth() + 1, 0);
  const startDay = startOfMonth.getDay();
  const daysInMonth = endOfMonth.getDate();

  const days = [];
  for (let i = 0; i < startDay; i++) days.push(null);
  for (let d = 1; d <= daysInMonth; d++) days.push(d);

  const downloadEntries = () => {
    let content = "";
    Object.entries(entries).forEach(([date, dayEntries]) => {
      dayEntries.forEach(e => {
        content += `${date} – ${new Date(e.timestamp).toLocaleTimeString([], {
          hour: "2-digit",
          minute: "2-digit"
        })}\n${e.text}\n\n`;
      });
    });

    const blob = new Blob([content], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "journal_entries.txt";
    link.click();
  };

  return (
    <div className="min-h-screen p-4 flex flex-col">
      <div className="max-w-xl mx-auto flex flex-col flex-1">

        <h1 className="text-2xl font-semibold mb-1">My Journal</h1>
        <p className="text-sm text-gray-500 mb-3">A quiet space to meet yourself</p>

        <div className="flex justify-between items-center mb-2">
          <p className="text-xs text-gray-400">
            {currentDate}
            {currentTimestamp && " · " +
              new Date(currentTimestamp).toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" })}
          </p>

          <button
            onClick={() => setLined(!lined)}
            className="text-sm px-3 py-1 bg-white shadow rounded-lg"
          >
            {lined ? "Blank" : "Lined"}
          </button>
        </div>

        <div className="bg-white rounded-2xl shadow-lg p-4 flex flex-col flex-1">
          <textarea
            value={text}
            onChange={e => setText(e.target.value)}
            placeholder="Start writing…"
            className={`w-full flex-1 resize-none focus:outline-none ${
              lined
                ? "bg-[linear-gradient(transparent_95%,rgba(0,0,0,0.05)_96%)] bg-[length:100%_2rem]"
                : ""
            }`}
          />
        </div>

        <div className="flex justify-between text-sm mt-3">
          <button onClick={goEarlierEntry}>← Earlier entry</button>
          <button onClick={goLaterEntry}>Later entry →</button>
        </div>

        <div className="flex justify-center mt-4">
          <button
            onClick={() => setShowCalendar(true)}
            className="px-4 py-2 bg-white shadow rounded-lg text-sm"
          >
            Calendar
          </button>
        </div>
      </div>

      {/* Calendar Overlay */}
      {showCalendar && (
        <div className="fixed inset-0 bg-black/40 flex items-center justify-center">
          <div className="bg-white rounded-2xl p-4 w-[90%] max-w-md">
            <div className="flex justify-between items-center mb-3">
              <button onClick={() =>
                setCalendarMonth(m => new Date(m.getFullYear(), m.getMonth() - 1, 1))
              }>‹</button>
              <h2 className="font-semibold">
                {calendarMonth.toLocaleString("default", { month: "long", year: "numeric" })}
              </h2>
              <button onClick={() =>
                setCalendarMonth(m => new Date(m.getFullYear(), m.getMonth() + 1, 1))
              }>›</button>
            </div>

            <div className="grid grid-cols-7 gap-2 text-center text-sm">
              {["S","M","T","W","T","F","S"].map(d => <div key={d}>{d}</div>)}
              {days.map((d, i) => {
                if (!d) return <div key={i} />;
                const dateKey = `${calendarMonth.getFullYear()}-${String(calendarMonth.getMonth()+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
                return (
                  <button
                    key={i}
                    onClick={() => {
                      setCurrentDate(dateKey);
                      const dayEntries = entries[dateKey] || [];
                      const idx = dayEntries.length ? dayEntries.length - 1 : null;
                      setEntryIndex(idx);
                      setText(idx !== null ? dayEntries[idx].text : "");
                      setShowCalendar(false);
                    }}
                    className="relative p-2 rounded-lg border"
                  >
                    {d}
                    {entries[dateKey] && (
                      <span
                        className="absolute inset-0 rounded-lg"
                        style={{ backgroundColor: "rgba(122,156,183,0.5)" }}
                      />
                    )}
                  </button>
                );
              })}
            </div>

            <div className="flex justify-between mt-4 text-sm">
              <button onClick={() => setShowCalendar(false)} className="underline">
                Close
              </button>
              <button onClick={downloadEntries} className="underline">
                Download
              </button>
            </div>

          </div>
        </div>
      )}
    </div>
  );
}

function MobileFrame({ children }) {
  return (
    <div className="min-h-screen flex justify-center bg-[#EFECE7]">
      <div className="w-full max-w-[430px] min-h-screen bg-[#EFECE7] overflow-hidden">
        {children}
      </div>
    </div>
  );
}
// <--- EVERYTHING inside your original JournalApp function stays intact
// It renders into "journalRoot" div
ReactDOM.createRoot(document.getElementById('journalRoot')).render(<JournalApp />);
</script>

</body>
</html>
