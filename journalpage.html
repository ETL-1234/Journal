<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Journal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #EFECE7;
      color: #000;
      display: flex;
      justify-content: center;
    }

    .app {
      max-width: 430px;
      width: 100%;
      min-height: 100vh;
      position: relative;
    }

    .page { display: none; min-height: 100vh; padding: 16px; box-sizing: border-box; }
    .page.active { display: block; }

    .cover-wrapper { position: relative; margin-top: 8px; }
    .cover-wrapper img { width: 100%; border-radius: 16px; box-shadow: 0 0px 0px rgba(0,0,0,0.12); }
    .skip-btn, .next-btn {
      position: absolute; background: none; border: none; cursor: pointer;
    }
    .skip-btn { bottom: 16px; left: 50%; transform: translateX(-50%); font-size: 14px; text-decoration: underline; }
    .next-btn { bottom: 16px; right: 16px; font-size: 28px; }

    .card {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.12);
      font-size: 14px;
      line-height: 1.6;
      margin-top: 2px;
      position: relative;
    }

    textarea {
      font-family: 'Inter', sans-serif;
    }

    #calendarOverlay button {
      border: none;
      padding: 6px 0;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>

<body>
<div class="app">

  <!-- COVER PAGE -->
  <div id="coverPage" class="page active">
    <div class="cover-wrapper">
      <img src="https://hkdgqdmxhtnxtcuqfovq.supabase.co/storage/v1/object/public/Other/MyJournal.png" alt="Journal cover" />
      <button class="skip-btn" onclick="showPage('journalPage')">Skip welcome</button>
      <button class="next-btn" onclick="showPage('welcomePage')">→</button>
    </div>
  </div>

  <!-- WELCOME PAGE -->
  <div id="welcomePage" class="page">
    <div class="card">
      <h1 style="font-size:22px; margin-bottom:16px;">Welcome to Your Journal!</h1>
      <p style="margin-bottom:20px;">This journal is yours, for you to journal however you like.</p>

      <p><strong>Suggestions for journaling:</strong></p>
      <p><em>Try to make it a habit to journal after a practice.</em></p>
      <p><em>Use the journal prompts from the journal section for inspiration.</em></p>
      <p><em>Find a time of day, morning or evening, to journal consistently.</em></p>

      <p style="margin-top:16px;"><strong>Practical information:</strong></p>
      <p>You can journal as often as you like.</p>
      <p>All journal entries are date and time-stamped.</p>
      <p>The journal works offline as well.</p>

      <p style="margin-top:16px;"><strong>Tracking:</strong></p>
      <p>On the daily journal page, you can skip back and forth between entries.</p>
      <p>Open calendar view to see how often you journal.</p>
      <p>Tap blue entries in the calendar to access that day.</p>

      <p style="margin-top:16px;"><strong>Saved:</strong></p>
      <p>Everything you write is auto-saved.</p>
      <p>Entries are saved for 365 days.</p>
      <p>You can download all entries as a txt file.</p>

      <p style="margin-top:16px;"><strong>Security:</strong></p>
      <p>All data is stored locally and is private.</p>

      <p style="margin-top:16px;"><em>Please note:</em></p>
      <p><em>If the app is deleted, your data is lost unless downloaded.</em></p>
      <p><em>Anyone with physical access to your device could read entries.</em></p>

      <button class="next-btn" onclick="showPage('journalPage')">→</button>
    </div>
  </div>

  <!-- JOURNAL PAGE -->
  <div id="journalPage" class="page">
   <div class="card" id="journalCard" style="background:none; box-shadow:none; margin-top:2px;">
      <h1 style="font-size:22px; margin-bottom:6px;">My Journal</h1>
      <p style="font-size:14px; color:#555; margin-bottom:8px;">A quiet space to meet yourself</p>

      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
  <p id="currentDate" style="font-size:12px; color:#888;"></p>

  <div style="display:flex; gap:8px;">
    <button id="newEntryBtn"
      style="font-size:16px; padding:8px 16px; border-radius:8px; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.1); background:rgba(255,255,255,0.7); transition: background 0.2s ease; cursor:pointer;">
      New Page
    </button>

    <button id="toggleLined"
      style="font-size:16px; padding:8px 16px; border-radius:8px; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.1); background:rgba(255,255,255,0.7); transition: background 0.2s ease; cursor:pointer;">
      Lined
    </button>
  </div>
</div>


      <div style="background:#fff; border-radius:16px; box-shadow:0 10px 25px rgba(0,0,0,0.12); padding:16px; display:flex; flex-direction:column;">
        <textarea id="journalTextarea" placeholder="Start writing…" style="width:100%; min-height:60vh; resize:none; border:none; outline:none; background:#fff; border-radius:16px; padding:16px; font-size:14px; line-height:1.6;"></textarea>
      </div>

      <div style="display:flex; justify-content:space-between; margin-top:12px; font-size:12px;">
        <button id="earlierEntry" style="background:none; border:none; cursor:pointer;">← Earlier entry</button>
        <button id="laterEntry" style="background:none; border:none; cursor:pointer;">Later entry →</button>
      </div>

      <div style="display:flex; justify-content:center; margin-top:16px;">
        <button id="openCalendar" style="font-size:16px; padding:12px 20px; border-radius:8px; border:none; box-shadow:0 4px 10px rgba(0,0,0,0.1); background:rgba(255,255,255,0.7); transition: background 0.2s ease; cursor:pointer;">Calendar</button>
      </div>
    </div>

    <!-- Calendar Overlay -->
    <div id="calendarOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); justify-content:center; align-items:center;">
      <div style="background:#fff; border-radius:16px; padding:16px; width:90%; max-width:360px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <button id="prevMonth">‹</button>
          <h2 id="calendarTitle" style="font-weight:bold;"></h2>
          <button id="nextMonth">›</button>
        </div>
        <div id="calendarGrid" style="display:grid; grid-template-columns:repeat(7,1fr); gap:4px; text-align:center; font-size:12px;"></div>
        <div style="display:flex; justify-content:space-between; margin-top:12px; font-size:12px;">
          <button id="closeCalendar" style="text-decoration:underline;">Close</button>
          <button id="downloadEntries" style="text-decoration:underline;">Download</button>
        </div>
      </div>
    </div>
  </div>

</div>

<script>
  // PAGE SWITCHING
 function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');

  if(id === 'journalPage') {
    entryIndex = null;           // always start a new entry
    currentDate = new Date().toISOString().split('T')[0]; // reset date to today
    textarea.value = '';          // clear textarea
    updateDisplay();
  }
}


  // SWIPE SUPPORT
  let startX = 0;
  document.addEventListener('touchstart', e => startX = e.touches[0].clientX);
  document.addEventListener('touchend', e => {
    const diff = e.changedTouches[0].clientX - startX;
    const current = document.querySelector('.page.active').id;
    if (diff < -50) {
      if (current === 'coverPage') showPage('welcomePage');
      else if (current === 'welcomePage') showPage('journalPage');
    }
  });

  // JOURNAL LOGIC
  const STORAGE_KEY = 'journal_entries';
  let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  let today = new Date();
  let currentDate = today.toISOString().split('T')[0];
  let entryIndex = null;
  let lined = false;

  const textarea = document.getElementById('journalTextarea');
  const currentDateEl = document.getElementById('currentDate');
  const toggleLinedBtn = document.getElementById('toggleLined');
  const earlierBtn = document.getElementById('earlierEntry');
  const laterBtn = document.getElementById('laterEntry');
  const calendarOverlay = document.getElementById('calendarOverlay');
  const openCalendarBtn = document.getElementById('openCalendar');
  const closeCalendarBtn = document.getElementById('closeCalendar');
  const downloadBtn = document.getElementById('downloadEntries');
  const calendarGrid = document.getElementById('calendarGrid');
  const calendarTitle = document.getElementById('calendarTitle');
  const prevMonthBtn = document.getElementById('prevMonth');
  const nextMonthBtn = document.getElementById('nextMonth');
  let calendarMonth = new Date(today.getFullYear(), today.getMonth(), 1);
  const newEntryBtn = document.getElementById('newEntryBtn');


  function updateDisplay() {
  const dayEntries = entries[currentDate] || [];

  if (entryIndex !== null && dayEntries[entryIndex]) {
    // Existing entry
    textarea.value = dayEntries[entryIndex].text || '';
    const ts = dayEntries[entryIndex].timestamp
      ? new Date(dayEntries[entryIndex].timestamp).toLocaleTimeString([], {
          hour: '2-digit',
          minute: '2-digit'
        })
      : '';
    currentDateEl.textContent = currentDate + (ts ? ' · ' + ts : '');
  } else {
    // New entry
    textarea.value = '';
    currentDateEl.textContent = currentDate;
  }

  // Lined / blank toggle
  toggleLinedBtn.textContent = lined ? 'Blank' : 'Lined';
  textarea.style.background = lined
    ? 'repeating-linear-gradient(transparent, transparent 28px, rgba(0,0,0,0.05) 29px)'
    : 'none';

  // --- NAV BUTTON STATE ---
  if (entryIndex === null || dayEntries.length === 0) {
    // New entry or no entries at all
    earlierBtn.disabled = true;
    laterBtn.disabled = true;
  } else {
    earlierBtn.disabled = entryIndex === 0;
    laterBtn.disabled = entryIndex === dayEntries.length - 1;
  }

  // Visual feedback
  [earlierBtn, laterBtn].forEach(btn => {
    btn.style.opacity = btn.disabled ? '0.4' : '1';
    btn.style.pointerEvents = btn.disabled ? 'none' : 'auto';
  });
}



  function saveEntry() {
    if (!textarea.value) return;
    if (!entries[currentDate]) entries[currentDate] = [];
    if (entryIndex === null) {
      entries[currentDate].push({ text: textarea.value, timestamp: new Date().toString() });
      entryIndex = entries[currentDate].length - 1;
    } else {
      entries[currentDate][entryIndex].text = textarea.value;
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
  }

  textarea.addEventListener('input', saveEntry);

  toggleLinedBtn.addEventListener('click', () => { lined = !lined; updateDisplay(); });
  earlierBtn.addEventListener('click', () => { if(entryIndex>0){entryIndex--; updateDisplay();}});
  laterBtn.addEventListener('click', () => { if(entryIndex<(entries[currentDate]?.length||0)-1){entryIndex++; updateDisplay();}});

  newEntryBtn.addEventListener('click', () => {
  entryIndex = null;                         // detach from old entries
  currentDate = new Date().toISOString().split('T')[0]; // today
  textarea.value = '';                       // blank page
  updateDisplay();
  textarea.focus();
});

  // CALENDAR
  function generateCalendar() {
    const year = calendarMonth.getFullYear();
    const month = calendarMonth.getMonth();
    calendarTitle.textContent = calendarMonth.toLocaleString('default', {month:'long', year:'numeric'});
    calendarGrid.innerHTML = '';
    const startDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();

    ['S','M','T','W','T','F','S'].forEach(d => { const div=document.createElement('div'); div.textContent=d; calendarGrid.appendChild(div);});
    for(let i=0;i<startDay;i++) calendarGrid.appendChild(document.createElement('div'));

    for(let d=1;d<=daysInMonth;d++){
      const btn=document.createElement('button');
      btn.textContent=d;
      const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      if(entries[dateKey]) btn.style.background='rgba(122,156,183,0.5)';
      btn.addEventListener('click', ()=>{currentDate=dateKey; entryIndex=(entries[currentDate]?.length||0)-1; updateDisplay(); calendarOverlay.style.display='none';});
      calendarGrid.appendChild(btn);
    }
  }

  openCalendarBtn.addEventListener('click', ()=>{calendarOverlay.style.display='flex'; generateCalendar();});
  closeCalendarBtn.addEventListener('click', ()=>calendarOverlay.style.display='none');
  prevMonthBtn.addEventListener('click', ()=>{calendarMonth.setMonth(calendarMonth.getMonth()-1); generateCalendar();});
  nextMonthBtn.addEventListener('click', ()=>{calendarMonth.setMonth(calendarMonth.getMonth()+1); generateCalendar();});
  downloadBtn.addEventListener('click', ()=>{
    let content=''; Object.entries(entries).forEach(([date, dayEntries])=>{ dayEntries.forEach(e=>{content+=`${date} – ${new Date(e.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}\n${e.text}\n\n`;});});
    const blob = new Blob([content], {type:'text/plain'});
    const link=document.createElement('a'); link.href=URL.createObjectURL(blob); link.download='journal_entries.txt'; link.click();
  });

  updateDisplay();
</script>

</body>
</html>
